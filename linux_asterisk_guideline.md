# 🐧 Linux Asterisk Setup Guide for NPCL Voice Assistant\n\n## 📋 **Prerequisites**\n\n### **System Requirements:**\n- Ubuntu 20.04+ / CentOS 8+ / Debian 11+\n- Python 3.8+\n- Asterisk 18+ (you have this installed)\n- Zoiper 5 (you have this installed)\n- Git\n- Build tools\n- Internet connection for downloading dependencies\n\n### **Check Your Current Setup:**\n```bash\n# Check Asterisk version\nasterisk -V\n\n# Check if Asterisk is running\nsudo systemctl status asterisk\n\n# Check Python version\npython3 --version\n\n# Check if ARI is enabled\nsudo asterisk -rx \"http show status\"\n\n# Check if git is installed\ngit --version\n```\n\n## 📥 **Step 0: Fresh Project Setup (Git Clone)**\n\n### **Clone the Project:**\n```bash\n# Navigate to your desired directory\ncd /home/$(whoami)/  # or wherever you want the project\n\n# Clone the repository\ngit clone https://github.com/your-repo/NPCL-Asterisk-ARI-Assistant.git\n# OR if you have the project files locally:\n# cp -r /path/to/NPCL-Asterisk-ARI-Assistant ./\n\n# Navigate to project directory\ncd NPCL-Asterisk-ARI-Assistant\n\n# Check project structure\nls -la\n```\n\n### **Expected Project Structure:**\n```\nNPCL-Asterisk-ARI-Assistant/\n├── src/                    # Main application code\n├── config/                 # Configuration files\n├── tests/                  # Test files\n├── requirements.txt        # Python dependencies\n├── .env.example           # Environment variables template\n├── README.md              # Project documentation\n└── linux_asterisk_guideline.md  # This guide\n```\n\n## 🚀 **Step 1: Install System Dependencies**\n\n### **Update System:**\n```bash\n# Ubuntu/Debian\nsudo apt update && sudo apt upgrade -y\n\n# CentOS/RHEL/Rocky Linux\nsudo yum update -y\n# OR for newer versions:\nsudo dnf update -y\n```\n\n### **Install Essential Build Tools:**\n```bash\n# Ubuntu/Debian\nsudo apt install -y \\\n    python3 \\\n    python3-pip \\\n    python3-venv \\\n    python3-dev \\\n    build-essential \\\n    gcc \\\n    g++ \\\n    make \\\n    cmake \\\n    pkg-config \\\n    git \\\n    curl \\\n    wget \\\n    htop \\\n    nano \\\n    vim\n\n# CentOS/RHEL/Rocky Linux\nsudo yum groupinstall -y \"Development Tools\"\nsudo yum install -y \\\n    python3 \\\n    python3-pip \\\n    python3-devel \\\n    gcc \\\n    gcc-c++ \\\n    make \\\n    cmake \\\n    pkgconfig \\\n    git \\\n    curl \\\n    wget \\\n    htop \\\n    nano \\\n    vim\n\n# OR for newer versions:\nsudo dnf groupinstall -y \"Development Tools\"\nsudo dnf install -y \\\n    python3 \\\n    python3-pip \\\n    python3-devel \\\n    gcc \\\n    gcc-c++ \\\n    make \\\n    cmake \\\n    pkgconfig \\\n    git \\\n    curl \\\n    wget \\\n    htop \\\n    nano \\\n    vim\n```\n\n### **Install Audio Libraries:**\n```bash\n# Ubuntu/Debian\nsudo apt install -y \\\n    libasound2-dev \\\n    portaudio19-dev \\\n    libportaudio2 \\\n    libportaudiocpp0 \\\n    ffmpeg \\\n    libavcodec-dev \\\n    libavformat-dev \\\n    libswscale-dev \\\n    libsdl2-dev \\\n    libsdl2-mixer-dev\n\n# CentOS/RHEL/Rocky Linux\nsudo yum install -y \\\n    alsa-lib-devel \\\n    portaudio-devel \\\n    ffmpeg-devel \\\n    SDL2-devel \\\n    SDL2_mixer-devel\n\n# OR for newer versions:\nsudo dnf install -y \\\n    alsa-lib-devel \\\n    portaudio-devel \\\n    ffmpeg-devel \\\n    SDL2-devel \\\n    SDL2_mixer-devel\n```\n\n### **Install Asterisk Development Headers:**\n```bash\n# Ubuntu/Debian\nsudo apt install -y asterisk-dev asterisk-config\n\n# CentOS/RHEL/Rocky Linux\nsudo yum install -y asterisk-devel\n# OR\nsudo dnf install -y asterisk-devel\n```\n\n### **Install Additional Python Tools:**\n```bash\n# Upgrade pip to latest version\npython3 -m pip install --user --upgrade pip\n\n# Install virtualenv if not available\npython3 -m pip install --user virtualenv\n\n# Verify installations\npython3 --version\npip3 --version\nvirtualenv --version\n```\n\n## 🔧 **Step 2: Configure Asterisk for ARI**\n\n### **Enable ARI Module:**\n```bash\n# Connect to Asterisk CLI\nsudo asterisk -r\n\n# In Asterisk CLI, run:\nmodule load res_ari.so\nmodule load res_ari_channels.so\nmodule load res_ari_bridges.so\nmodule load res_ari_applications.so\nmodule load res_ari_events.so\nmodule load res_http_websocket.so\ncore reload\nexit\n```\n\n### **Configure ARI Settings:**\n```bash\n# Edit ARI configuration\nsudo nano /etc/asterisk/ari.conf\n```\n\n**Add this content to `/etc/asterisk/ari.conf`:**\n```ini\n[general]\nenabled = yes\npretty = yes\nallowed_origins = *\n\n[asterisk]\ntype = user\nread_only = no\npassword = 1234\n```\n\n### **Configure HTTP Settings:**\n```bash\n# Edit HTTP configuration\nsudo nano /etc/asterisk/http.conf\n```\n\n**Add this content to `/etc/asterisk/http.conf`:**\n```ini\n[general]\nenabled=yes\nbindaddr=0.0.0.0\nbindport=8088\nprefix=asterisk\n```\n\n### **Configure PJSIP for SIP:**\n```bash\n# Edit PJSIP configuration\nsudo nano /etc/asterisk/pjsip.conf\n```\n\n**Add this content to `/etc/asterisk/pjsip.conf`:**\n```ini\n[global]\ntype=global\nendpoint_identifier_order=ip,username,anonymous\n\n[transport-udp]\ntype=transport\nprotocol=udp\nbind=0.0.0.0:5060\n\n; Test extension 1000\n[1000]\ntype=endpoint\ncontext=openai-voice-assistant\ndisallow=all\nallow=ulaw\nallow=alaw\nauth=1000\naors=1000\nrtp_symmetric=yes\nforce_rport=yes\nrewrite_contact=yes\ndirect_media=no\n\n[1000]\ntype=auth\nauth_type=userpass\npassword=1234\nusername=1000\n\n[1000]\ntype=aor\nmax_contacts=1\n\n; SIP Client 1001 (Zoiper)\n[1001]\ntype=endpoint\ncontext=openai-voice-assistant\ndisallow=all\nallow=ulaw\nallow=alaw\nauth=1001\naors=1001\nrtp_symmetric=yes\nforce_rport=yes\nrewrite_contact=yes\ndirect_media=no\n\n[1001]\ntype=auth\nauth_type=userpass\npassword=1234\nusername=1001\n\n[1001]\ntype=aor\nmax_contacts=1\n```\n\n### **Configure Extensions (Dialplan):**\n```bash\n# Edit extensions configuration\nsudo nano /etc/asterisk/extensions.conf\n```\n\n**Add this content to `/etc/asterisk/extensions.conf`:**\n```ini\n[general]\nstatic=yes\nwriteprotect=no\nclearglobalvars=no\n\n[globals]\nOPENAI_APP=openai-voice-assistant\n\n[openai-voice-assistant]\n; Main NPCL Voice Assistant Extension\nexten => 1000,1,NoOp(NPCL Voice Assistant - Main Line)\nsame => n,Answer()\nsame => n,Wait(1)\nsame => n,Playback(silence/1)\nsame => n,Stasis(${OPENAI_APP},${CALLERID(num)},${EXTEN})\nsame => n,Hangup()\n\n; Simple test extension (no Stasis)\nexten => 1010,1,NoOp(Simple Test Extension)\nsame => n,Answer()\nsame => n,Wait(2)\nsame => n,Playback(demo-congrats)\nsame => n,Wait(5)\nsame => n,Hangup()\n\n; Echo test\nexten => 9000,1,NoOp(Echo Test)\nsame => n,Answer()\nsame => n,Echo()\nsame => n,Hangup()\n\n[default]\ninclude => openai-voice-assistant\n\n[from-sip]\ninclude => openai-voice-assistant\n```\n\n### **Configure RTP:**\n```bash\n# Edit RTP configuration\nsudo nano /etc/asterisk/rtp.conf\n```\n\n**Add this content to `/etc/asterisk/rtp.conf`:**\n```ini\n[general]\nrtpstart=10000\nrtpend=10100\nrtpsymmetric=yes\nrtptimeout=60\nrtpholdtimeout=300\nrtpkeepalive=5\nprobation=0\nstrictrtp=yes\nicesupport=no\nsrtpenable=no\n```\n\n### **Restart Asterisk:**\n```bash\n# Restart Asterisk to apply changes\nsudo systemctl restart asterisk\n\n# Check if it's running\nsudo systemctl status asterisk\n\n# Check ARI is working\ncurl -u asterisk:1234 http://localhost:8088/ari/asterisk/info\n```\n\n## 🐍 **Step 3: Setup Python Environment**\n\n### **Create Virtual Environment:**\n```bash\n# Navigate to your project directory\ncd NPCL-Asterisk-ARI-Assistant\n\n# Create virtual environment\npython3 -m venv .venv\n\n# Activate virtual environment\nsource .venv/bin/activate\n\n# Verify virtual environment is active (should show (.venv) in prompt)\nwhich python\nwhich pip\n\n# Upgrade pip in virtual environment\npip install --upgrade pip setuptools wheel\n```\n\n### **Install Python Dependencies:**\n```bash\n# Method 1: If requirements.txt exists\nif [ -f \"requirements.txt\" ]; then\n    pip install -r requirements.txt\nelse\n    echo \"requirements.txt not found, installing manually...\"\nfi\n\n# Method 2: Manual installation (if requirements.txt doesn't exist)\npip install \\\n    openai>=1.0.0 \\\n    uvicorn>=0.24.0 \\\n    fastapi>=0.104.0 \\\n    pyttsx3>=2.90 \\\n    websockets>=10.0 \\\n    pygame>=2.5.0 \\\n    requests>=2.31.0 \\\n    pydantic>=2.5.0 \\\n    python-multipart>=0.0.6 \\\n    aiofiles>=23.0.0 \\\n    python-dotenv>=1.0.0 \\\n    numpy>=1.24.0 \\\n    scipy>=1.10.0 \\\n    pyaudio>=0.2.11 \\\n    speechrecognition>=3.10.0 \\\n    gtts>=2.3.0 \\\n    playsound>=1.3.0\n\n# Install additional audio dependencies\npip install \\\n    sounddevice>=0.4.6 \\\n    soundfile>=0.12.1 \\\n    librosa>=0.10.0 \\\n    webrtcvad>=2.0.10\n\n# Verify installations\npip list | grep -E \"openai|fastapi|uvicorn|pygame|websockets\"\n```\n\n### **Create requirements.txt (for future use):**\n```bash\n# Generate requirements.txt from current environment\npip freeze > requirements.txt\n\n# Check the file\ncat requirements.txt\n```\n\n### **Configure Environment Variables:**\n```bash\n# Check if .env.example exists\nls -la .env*\n\n# Copy example file if it exists\nif [ -f \".env.example\" ]; then\n    cp .env.example .env\nelse\n    # Create new .env file\n    touch .env\nfi\n\n# Edit the .env file\nnano .env\n```\n\n**Add this content to `.env`:**\n```bash\n# AI Provider Configuration\nAI_PROVIDER=openai\n\n# OpenAI API Configuration (REQUIRED - Get from https://platform.openai.com/api-keys)\nOPENAI_API_KEY=sk-your-actual-openai-api-key-here\nOPENAI_MODEL=gpt-4o-mini\nOPENAI_REALTIME_MODEL=gpt-4o-realtime-preview-2024-10-01\nOPENAI_TEMPERATURE=0.7\n\n# Voice Configuration\nVOICE_MODEL=alloy\nOPENAI_VOICE=alloy\nSPEECH_MODEL=whisper-1\nTTS_MODEL=tts-1-hd\n\n# Audio Configuration\nSAMPLE_RATE=16000\nCHUNK_SIZE=1024\nCHANNELS=1\nAUDIO_FORMAT=slin16\nAUDIO_SAMPLE_RATE=16000\nAUDIO_CHUNK_SIZE=1024\n\n# Asterisk ARI Configuration\nARI_BASE_URL=http://localhost:8088/ari\nARI_USERNAME=asterisk\nARI_PASSWORD=1234\nSTASIS_APP=openai-voice-assistant\n\n# External Media Configuration\nEXTERNAL_MEDIA_HOST=localhost\nEXTERNAL_MEDIA_PORT=8090\n\n# Voice Activity Detection\nVAD_ENERGY_THRESHOLD=300\nVAD_SILENCE_THRESHOLD=0.5\nVAD_SPEECH_THRESHOLD=0.1\n\n# Assistant Configuration\nASSISTANT_NAME=NPCL Assistant\nVOICE_LANGUAGE=en\nLISTEN_TIMEOUT=20.0\nPHRASE_TIME_LIMIT=15.0\n\n# System Configuration\nLOG_LEVEL=INFO\nENABLE_INTERRUPTION_HANDLING=true\nENABLE_VOICE_INTERRUPTION=true\nMAX_CALL_DURATION=3600\nAUTO_ANSWER_CALLS=true\n\n# Audio Processing Configuration\nENABLE_AUDIO_PROCESSING=true\nENABLE_REALTIME_AUDIO=true\nAUDIO_BUFFER_SIZE=1024\nAUDIO_LATENCY_TARGET=20\n```\n\n### **Important: Set Your OpenAI API Key:**\n```bash\n# Get your API key from: https://platform.openai.com/api-keys\n# Replace 'sk-your-actual-openai-api-key-here' with your real API key\n\n# Verify .env file is configured\ncat .env | grep OPENAI_API_KEY\n\n# Test API key (optional)\npython3 -c \"\nimport os\nfrom dotenv import load_dotenv\nload_dotenv()\napi_key = os.getenv('OPENAI_API_KEY')\nprint('API Key configured:' if api_key and api_key.startswith('sk-') else 'API Key missing or invalid')\n\"\n```\n\n## 🧪 **Step 4: Test System Components**\n\n### **Test 1: Asterisk ARI Connection**\n```bash\n# Test ARI endpoint\ncurl -u asterisk:1234 http://localhost:8088/ari/asterisk/info\n\n# Should return JSON with Asterisk info\n```\n\n### **Test 2: SIP Registration**\n```bash\n# Check SIP endpoints\nsudo asterisk -rx \"pjsip show endpoints\"\n\n# Should show endpoints 1000 and 1001\n```\n\n### **Test 3: Python Dependencies**\n```bash\n# Activate virtual environment\nsource .venv/bin/activate\n\n# Test OpenAI import\npython3 -c \"import openai; print('OpenAI: OK')\"\n\n# Test other dependencies\npython3 -c \"import fastapi, uvicorn, websockets, pygame, pydantic; print('All dependencies: OK')\"\n```\n\n## 🚀 **Step 5: Start the Voice Assistant**\n\n### **Pre-Start Verification:**\n```bash\n# Ensure you're in the project directory\npwd\n# Should show: /path/to/NPCL-Asterisk-ARI-Assistant\n\n# Activate virtual environment (if not already active)\nsource .venv/bin/activate\n\n# Verify Python environment\nwhich python\nwhich pip\n\n# Check if main server file exists\nls -la src/run_realtime_server.py\n\n# Test Python imports\npython3 -c \"import openai, fastapi, uvicorn, websockets, pygame; print('All imports successful!')\"\n```\n\n### **Method 1: Direct Start (Recommended)**\n```bash\n# Activate virtual environment\nsource .venv/bin/activate\n\n# Start the voice assistant server\npython3 src/run_realtime_server.py\n```\n\n### **Method 2: With Environment Variables Override**\n```bash\n# If you have environment variable conflicts\nenv -u OPENAI_API_KEY -u VOICE_MODEL VOICE_MODEL=alloy python3 src/run_realtime_server.py\n```\n\n### **Method 3: Background Start (for testing)**\n```bash\n# Start in background (useful for testing)\nnohup python3 src/run_realtime_server.py > voice_assistant.log 2>&1 &\n\n# Check if running\nps aux | grep run_realtime_server\n\n# View logs\ntail -f voice_assistant.log\n\n# Stop background process\npkill -f run_realtime_server\n```\n\n### **Expected Successful Output:**\n```\n🚀 STARTING NPCL VOICE ASSISTANT - REAL-TIME ARI SERVER (OPENAI)\n================================================================================\n🔍 Server Status: http://localhost:8000/status\n📞 Call Status: http://localhost:8000/ari/calls\n🌡️ Health Check: http://localhost:8000/ari/health\n================================================================================\n🤖 Assistant: NPCL Assistant\n🧠 AI Provider: OpenAI Real-time API\n🎯 AI Model: gpt-4o-realtime-preview-2024-10-01\n🎤 Voice: alloy\n🔊 Audio: slin16 @ 16000Hz\n📞 Stasis App: openai-voice-assistant\n🌐 External Media: localhost:8090\n🎙️ Voice Interruption: ✅ Enabled\n🔇 Noise Cancellation: ✅ Enabled\n================================================================================\nINFO:     Started server process [12345]\nINFO:     Waiting for application startup.\nINFO:     Application startup complete.\nINFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)\n```\n\n### **Verify Server is Running:**\n```bash\n# In a new terminal, test the server\ncurl http://localhost:8000/ari/health\n# Should return: {\"status\": \"healthy\"}\n\n# Check if Stasis app is registered\ncurl -u asterisk:1234 http://localhost:8088/ari/applications\n# Should show: [{\"name\": \"openai-voice-assistant\", ...}]\n\n# Check server status\ncurl http://localhost:8000/status\n```\n\n## 📱 **Step 6: Configure Zoiper 5**\n\n### **Account Settings:**\n```\nAccount Name: NPCL Test\nDomain: localhost (or your server IP)\nPort: 5060\nUsername: 1001\nPassword: 1234\nProtocol: SIP\nTransport: UDP\n```\n\n### **Advanced Settings:**\n```\nOutbound Proxy: (leave empty)\nSTUN Server: (leave empty)\nCodec Priority: G.711 mu-law (PCMU) - Enable this\nCodec Priority: G.711 a-law (PCMA) - Enable this\nOther codecs: Disable for testing\n```\n\n### **Audio Settings:**\n```\nMicrophone: Default system microphone\nSpeakers: Default system speakers\nEcho Cancellation: Enable\nNoise Suppression: Enable\n```\n\n## 🧪 **Step 7: Complete Testing Procedure**\n\n### **Pre-Test Verification:**\n```bash\n# 1. Check Asterisk is running\nsudo systemctl status asterisk\n\n# 2. Check voice assistant server is running\nps aux | grep run_realtime_server\n\n# 3. Check all services are accessible\ncurl -u asterisk:1234 http://localhost:8088/ari/asterisk/info\ncurl http://localhost:8000/ari/health\n\n# 4. Check SIP endpoints\nsudo asterisk -rx \"pjsip show endpoints\"\n```\n\n### **Test 1: Basic SIP Registration**\n```bash\n# Check if Zoiper registered successfully\nsudo asterisk -rx \"pjsip show endpoints\"\n\n# Expected output:\n# Endpoint: 1001    Not in use    0 of inf\n#   Contact: 1001/sip:1001@YOUR_IP:PORT\n\n# If not registered, check Zoiper settings:\n# - Server: localhost (or your server IP)\n# - Username: 1001\n# - Password: 1234\n# - Port: 5060\n```\n\n### **Test 2: Simple Call Test (No AI)**\n```bash\n# In Zoiper, dial: 1010\n# Expected: \n# - Call connects immediately\n# - Hear \"demo-congrats\" message\n# - Call lasts about 7 seconds\n# - Shows both local AND remote codecs\n\n# Check call details in Zoiper:\n# Local codecs: G.711 mu-law ✅\n# Remote codecs: G.711 mu-law ✅ (NOT \"None\")\n```\n\n### **Test 3: Echo Test**\n```bash\n# In Zoiper, dial: 9000\n# Expected:\n# - Call connects\n# - Everything you say is echoed back\n# - Confirms bidirectional audio\n# - Both codecs negotiated properly\n```\n\n### **Test 4: Voice Assistant Test (AI Conversation)**\n```bash\n# IMPORTANT: Ensure voice assistant server is running first!\n# Check: python3 src/run_realtime_server.py should be active\n\n# In Zoiper, dial: 1000\n# Expected:\n# - Call connects immediately\n# - Hear AI voice greeting (\"Hello, I'm NPCL Assistant...\")\n# - Can have conversation with AI\n# - AI responds to your questions\n# - Call can last indefinitely\n# - Both codecs properly negotiated\n\n# If you hear silence or call drops:\n# 1. Check voice assistant server logs\n# 2. Verify OpenAI API key is set\n# 3. Check network connectivity\n```\n\n### **Test 5: Advanced Conversation Test**\n```bash\n# After successful connection to 1000:\n# Try these conversation starters:\n\n# \"Hello, how are you?\"\n# \"What services does NPCL provide?\"\n# \"I need help with my electricity bill\"\n# \"Report a power outage\"\n# \"What's the weather like?\"\n\n# Expected:\n# - AI responds naturally to each query\n# - Conversation flows smoothly\n# - No audio dropouts or delays\n# - Professional, helpful responses\n```\n\n## 🔍 **Step 8: Troubleshooting Commands**\n\n### **Check Asterisk Status:**\n```bash\n# Asterisk service status\nsudo systemctl status asterisk\n\n# Asterisk CLI\nsudo asterisk -r\n\n# In CLI:\ncore show channels\npjsip show endpoints\nhttp show status\nmodule show like ari\n```\n\n### **Check Network Connectivity:**\n```bash\n# Check if ports are open\nsudo netstat -tulpn | grep :5060  # SIP\nsudo netstat -tulpn | grep :8088  # ARI\nsudo netstat -tulpn | grep :8000  # Voice Assistant\nsudo netstat -tulpn | grep :8090  # External Media\n\n# Test ARI connection\ncurl -u asterisk:1234 http://localhost:8088/ari/applications\n\n# Test voice assistant\ncurl http://localhost:8000/ari/health\n```\n\n### **Check Audio System:**\n```bash\n# Check audio devices\naplay -l  # List playback devices\narecord -l  # List recording devices\n\n# Test audio\nspeaker-test -t sine -f 1000 -l 1  # Test speakers\narecord -f cd -d 5 test.wav && aplay test.wav  # Test microphone\n```\n\n### **Debug Logs:**\n```bash\n# Asterisk logs\nsudo tail -f /var/log/asterisk/messages\nsudo tail -f /var/log/asterisk/full\n\n# Voice assistant logs\ntail -f server.log  # If logging to file\n\n# System logs\nsudo journalctl -u asterisk -f\n```\n\n## 🎯 **Step 9: Expected Test Results**\n\n### **Successful Codec Negotiation:**\n```\n✅ BEFORE (Docker issue):\nLocal codecs: G.711 mu-law\nRemote codecs: None\n\n✅ AFTER (Linux native):\nLocal codecs: G.711 mu-law\nRemote codecs: G.711 mu-law\n```\n\n### **Successful Call Flow:**\n1. **Registration**: Zoiper shows \"Registered\"\n2. **Call Setup**: Dial 1000, call connects immediately\n3. **Audio**: Hear AI voice greeting\n4. **Interaction**: Can speak and get AI responses\n5. **Duration**: Call lasts indefinitely (not limited to 32 seconds)\n6. **Quality**: \"Excellent\" call quality\n\n## 🚨 **Common Issues and Solutions**\n\n### **Issue 1: \"Stasis app doesn't exist\"**\n```bash\n# Solution: Ensure voice assistant server is running\npython3 src/run_realtime_server.py\n\n# Check if registered\ncurl -u asterisk:1234 http://localhost:8088/ari/applications\n```\n\n### **Issue 2: \"No audio\" or \"One-way audio\"**\n```bash\n# Check RTP ports in firewall\nsudo ufw allow 10000:10100/udp  # Ubuntu\nsudo firewall-cmd --add-port=10000-10100/udp --permanent  # CentOS\n\n# Check audio devices\naplay -l && arecord -l\n```\n\n### **Issue 3: \"Connection refused\"**\n```bash\n# Check if services are running\nsudo systemctl status asterisk\nps aux | grep run_realtime_server\n\n# Check firewall\nsudo ufw status  # Ubuntu\nsudo firewall-cmd --list-all  # CentOS\n```\n\n### **Issue 4: \"Module not found\"**\n```bash\n# Reinstall Python dependencies\npip install --upgrade -r requirements.txt\n\n# Check Python path\npython3 -c \"import sys; print(sys.path)\"\n```\n\n## 🎉 **Success Criteria**\n\nThe system is working correctly when:\n\n1. ✅ **Zoiper Registration**: Shows \"Registered\" status\n2. ✅ **Call Connection**: Calls to 1000 connect immediately\n3. ✅ **Codec Negotiation**: Both local AND remote codecs show G.711 mu-law\n4. ✅ **AI Response**: Hear clear AI voice greeting and responses\n5. ✅ **Bidirectional Audio**: Can speak and get responses\n6. ✅ **Call Duration**: No 32-second limitation\n7. ✅ **Call Quality**: Shows \"Excellent\"\n\n## 🎯 **Quick Start Commands (Complete Workflow)**\n\n### **Fresh System Setup (One-time):**\n```bash\n# 1. Clone project\ngit clone https://github.com/your-repo/NPCL-Asterisk-ARI-Assistant.git\ncd NPCL-Asterisk-ARI-Assistant\n\n# 2. Install system dependencies\nsudo apt update && sudo apt install -y python3 python3-pip python3-venv python3-dev build-essential libasound2-dev portaudio19-dev\n\n# 3. Create virtual environment\npython3 -m venv .venv\nsource .venv/bin/activate\n\n# 4. Install Python packages\npip install --upgrade pip\npip install openai uvicorn fastapi websockets pygame requests pydantic python-dotenv\n\n# 5. Configure environment\ncp .env.example .env\nnano .env  # Add your OpenAI API key\n\n# 6. Configure Asterisk (follow Step 2 in this guide)\n```\n\n### **Daily Startup (Every time):**\n```bash\n# 1. Start Asterisk\nsudo systemctl start asterisk\n\n# 2. Navigate to project\ncd NPCL-Asterisk-ARI-Assistant\n\n# 3. Activate Python environment\nsource .venv/bin/activate\n\n# 4. Start voice assistant\npython3 src/run_realtime_server.py\n\n# 5. Configure Zoiper:\n#    - Server: localhost\n#    - Username: 1001\n#    - Password: 1234\n#    - Port: 5060\n\n# 6. Test calls:\n#    - Dial 1010 (simple test)\n#    - Dial 1000 (AI conversation)\n\n# 7. Verify codec negotiation in Zoiper call details\n```\n\n### **Troubleshooting Commands:**\n```bash\n# Check services\nsudo systemctl status asterisk\nps aux | grep run_realtime_server\n\n# Test connectivity\ncurl -u asterisk:1234 http://localhost:8088/ari/asterisk/info\ncurl http://localhost:8000/ari/health\n\n# Check SIP registration\nsudo asterisk -rx \"pjsip show endpoints\"\n\n# View logs\nsudo tail -f /var/log/asterisk/messages\ntail -f voice_assistant.log\n```\n\n### **Success Verification:**\n```bash\n# ✅ Zoiper shows \"Registered\"\n# ✅ Call to 1010: Hear congratulations message\n# ✅ Call to 1000: Hear AI greeting and conversation\n# ✅ Codec details show:\n#     Local codecs: G.711 mu-law\n#     Remote codecs: G.711 mu-law (NOT \"None\")\n# ✅ Call quality: Excellent\n# ✅ No 32-second limitation\n```\n\n## 🔧 **Performance Optimization**\n\n### **For Better Performance:**\n```bash\n# Increase RTP buffer\necho 'net.core.rmem_max = 16777216' | sudo tee -a /etc/sysctl.conf\necho 'net.core.wmem_max = 16777216' | sudo tee -a /etc/sysctl.conf\nsudo sysctl -p\n\n# Set CPU governor to performance\necho performance | sudo tee /sys/devices/system/cpu/cpu*/cpufreq/scaling_governor\n\n# Increase process limits\necho '* soft nofile 65536' | sudo tee -a /etc/security/limits.conf\necho '* hard nofile 65536' | sudo tee -a /etc/security/limits.conf\n```\n\n---\n\n## 🎯 **Final Notes & Success Confirmation**\n\n### **Why This Setup Works:**\n- ✅ **Native Linux** resolves Docker networking issues\n- ✅ **Direct hardware access** improves audio performance  \n- ✅ **System-level Asterisk** provides better codec support\n- ✅ **Real-time processing** works better without containerization\n- ✅ **Fresh virtual environment** ensures clean dependencies\n- ✅ **Proper SIP configuration** enables codec negotiation\n\n### **Expected Results:**\n\n**BEFORE (Docker/Issues):**\n```\n❌ Local codecs: G.711 mu-law\n❌ Remote codecs: None\n❌ Call duration: Limited to ~32 seconds\n❌ Stasis app errors\n❌ Audio issues\n```\n\n**AFTER (Native Linux):**\n```\n✅ Local codecs: G.711 mu-law\n✅ Remote codecs: G.711 mu-law\n✅ Call duration: Unlimited\n✅ Stasis app: Working\n✅ AI conversation: Active\n✅ Call quality: Excellent\n```\n\n### **User Confirmation (Based on Your Success):**\n\n🎉 **\"Zoiper is answering hello world successfully\"** - This confirms:\n- ✅ SIP registration working\n- ✅ Codec negotiation working  \n- ✅ Basic audio working\n- ✅ Asterisk configuration correct\n\n**Now you just need to start the voice assistant for full AI conversation!**\n\n### **Next Steps After Setup:**\n1. **Start voice assistant**: `python3 src/run_realtime_server.py`\n2. **Call extension 1000**: Should hear AI greeting\n3. **Have conversation**: Ask questions, get AI responses\n4. **Verify codecs**: Both local and remote should show G.711 mu-law\n\n**This setup completely resolves the \"remote codecs: None\" issue!** 🚀\n\n---\n\n## 📞 **Support & Troubleshooting**\n\nIf you encounter any issues:\n\n1. **Check the troubleshooting section** in this guide\n2. **Verify all dependencies** are installed correctly\n3. **Ensure virtual environment** is activated\n4. **Check Asterisk logs** for detailed error messages\n5. **Test step by step** following the testing procedure\n\n**The native Linux setup should provide a stable, high-performance voice assistant system!** 🎯\n"