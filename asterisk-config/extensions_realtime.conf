[general]
static=yes
writeprotect=no
clearglobalvars=no

[globals]
; Global variables for the NPCL Telephonic Bot
OPENAI_APP=openai-voice-assistant
EXTERNAL_MEDIA_HOST=localhost
EXTERNAL_MEDIA_PORT=8090

[openai-voice-assistant]
; Main NPCL Telephonic Bot Extension - REAL-TIME VERSION
; This version enters Stasis IMMEDIATELY for proper external media
exten => 1000,1,NoOp(NPCL Telephonic Bot - Real-time Main Line)
same => n,Set(CHANNEL(hangup_handler_push)=hangup-handler,s,1)
same => n,Answer()
same => n,Set(TALK_DETECT(set)=4,160)  ; Enable talk detection
same => n,Wait(0.5)  ; Brief pause to establish media
same => n,Stasis(${OPENAI_APP},${CALLERID(num)},${EXTEN})  ; IMMEDIATE STASIS ENTRY
same => n,Hangup()

; Customer Service Queue
exten => 1001,1,NoOp(NPCL Customer Service Queue)
same => n,Answer()
same => n,Playback(welcome)
same => n,Queue(customer-service,t,,,300)
same => n,Hangup()

; Technical Support Queue
exten => 1002,1,NoOp(NPCL Technical Support Queue)
same => n,Answer()
same => n,Playback(technical-support)
same => n,Queue(technical-support,t,,,300)
same => n,Hangup()

; Billing Department
exten => 1003,1,NoOp(NPCL Billing Department)
same => n,Answer()
same => n,Playback(billing-department)
same => n,Queue(billing,t,,,300)
same => n,Hangup()

; Emergency Power Outage Reporting
exten => 1004,1,NoOp(NPCL Emergency Outage Reporting)
same => n,Answer()
same => n,Playback(emergency-outage)
same => n,Stasis(${OPENAI_APP},${CALLERID(num)},emergency)
same => n,Hangup()

; Test Extensions
exten => 9000,1,NoOp(Echo Test)
same => n,Answer()
same => n,Echo()
same => n,Hangup()

; Codec Test Extension (No Stasis)
exten => 1010,1,NoOp(Codec Test - No Stasis)
same => n,Answer()
same => n,Wait(2)
same => n,Playback(demo-congrats)
same => n,Wait(5)
same => n,Hangup()

; Welcome Test Extension (Asterisk Playback)
exten => 1011,1,NoOp(Welcome Test - Asterisk Playback)
same => n,Answer()
same => n,Wait(1)
same => n,Playback(/home/ameen/AsteriskARI-Bot/sounds/welcome)
same => n,Wait(2)
same => n,Hangup()

; Emergency fallback for any other extension
exten => _X.,1,NoOp(Fallback for ${EXTEN})
same => n,Answer()
same => n,Playback(invalid)
same => n,Wait(1)
same => n,Hangup()

; Hangup handler for cleanup and data logging
[hangup-handler]
exten => s,1,NoOp(Hangup handler for ${CHANNEL})
same => n,System(echo "Call ended: ${CHANNEL} at $(date) - Duration: ${CDR(duration)}s" >> /var/log/asterisk/npcl-calls.log)
same => n,Return()

[default]
include => openai-voice-assistant

; Inbound context for SIP calls
[from-sip]
include => openai-voice-assistant

; Context for internal calls
[internal]
include => openai-voice-assistant